
# Kwork Broadcast Bot (aiogram v2)

Готовый бот для рассылок с управлением скоростью и планированием задач (APScheduler), SQLite-хранилищем пользователей и простым управлением токеном через `.env` (и команду /set_token с последующей перезагрузкой).

> ВНИМАНИЕ по поводу капч: я не предоставляю/не включаю функциональность обхода капч у сторонних ботов Telegram. Это нарушает правила и может использоваться для обхода мер защиты. Вместо этого бот включает **легальные альтернативы**: собственная капча для новых пользователей и "капча с участием человека" (ручное подтверждение админом при необходимости).

## Возможности
- Добавление пользователей при /start (SQLite).
- Админ-команды: статистика, рассылка «сейчас» и по расписанию, периодические рассылки, список задач, отмена, настройка скорости (задержки) между сообщениями, настройка интервала «цикла», просмотр логов.
- Защита от флуда/ограничений Telegram: аккуратные задержки, обработка `RetryAfter` и блокировок.
- Управление токеном через `.env` и команду `/set_token <token>` (требуется перезапуск процесса).
- Собственная простая капча для новых пользователей (кнопка/квиз).

## Быстрый старт
1. **Python 3.10+**. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. Скопируйте `.env.example` в `.env` и заполните:
   ```env
   BOT_TOKEN=ваш_токен_бота
   ADMIN_IDS=123456789,987654321  # через запятую
   DB_PATH=data/bot.db
   DEFAULT_DELAY_MS=1200
   DEFAULT_CYCLE_SECONDS=3600
   ```
3. Запустите бота:
   ```bash
   python -m app.bot
   ```

### Сервисный запуск (systemd, опционально)
Создайте юнит `/etc/systemd/system/kwork-bot.service`:
```
[Unit]
Description=Kwork Broadcast Bot
After=network.target

[Service]
WorkingDirectory=/path/to/project
ExecStart=/usr/bin/python -m app.bot
Restart=always
Environment=PYTHONUNBUFFERED=1

[Install]
WantedBy=multi-user.target
```
```bash
sudo systemctl daemon-reload
sudo systemctl enable kwork-bot
sudo systemctl start kwork-bot
```

## Команды для админа
- `/stats` — количество пользователей.
- `/broadcast` — мастера создания мгновенной или отложенной рассылки.
- `/schedule YYYY-MM-DD HH:MM` — запланировать разовую рассылку после ввода текста.
- `/schedule_every <seconds>` — периодическая рассылка (интервал).
- `/jobs` — список задач (запланированных/активных).
- `/cancel <job_id>` — отмена рассылки/задачи.
- `/set_rate <ms>` — задержка между сообщениями (глобально).
- `/set_cycle <seconds>` — интервал цикла по умолчанию для периодических задач.
- `/set_token <TOKEN>` — сохранить новый токен в `.env` (перезапустите сервис/процесс).

## Ограничения
- Смена токена требует **перезапуска** (ограничение Telegram Bot API).
- Бот **не** пытается обходить капчи других ботов. Если клиент просит такую функцию — предложите «человеческое подтверждение» и законные интеграции внутри **своего** бота.

## Легальная альтернатива капч
- Встроенная простая капча на входе (кнопка/квиз), чтобы фильтровать ботов.
- Если нужно «решить капчу» извне — сделайте **ручной поток**: бот пересылает изображение/вопрос админу, админ подтверждает, бот выполняет действие (где это разрешено правилами).

---
Автор: подготовлено для продажи на Kwork.
